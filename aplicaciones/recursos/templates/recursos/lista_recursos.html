{% extends 'aplicaciones/base.html' %} 

{% block title %}{{ titulo_pagina }}{% endblock %} 

{% block contenido %}

<div class="max-w-6xl mx-auto my-10 px-4 sm:px-6 lg:px-8">
    
    {% if messages %}
        {% for message in messages %}
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4" role="alert">
                <p>{{ message }}</p>
            </div>
        {% endfor %}
    {% endif %}

    <div class="flex justify-between items-center mb-6 border-b pb-2">
        <h1 class="text-4xl font-extrabold text-gray-900">
            {{ titulo_pagina }} ðŸ“š
        </h1>
        {% if user.is_authenticated %}
            <a href="{% url 'recursos:crear_recurso' %}" class="btn-usm-secondary px-4 py-2 text-sm font-bold rounded-md hover:opacity-90 transition duration-150">
                + Subir Material
            </a>
        {% endif %}
    </div>

    <form method="get" action="{% url 'recursos:lista_recursos' %}" class="mb-6 flex space-x-4 items-center">
        
        <input 
            type="text" 
            name="q" 
            placeholder="Buscar por tÃ­tulo o descripciÃ³n..." 
            value="{{ query|default_if_none:'' }}"
            class="flex-grow p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
        >
        
        <select name="asignatura" class="p-2 border border-gray-300 rounded-md">
            <option value="">-- Todas las Asignaturas --</option>
            {% for asig in asignaturas %}
                <option value="{{ asig.pk }}" 
                    {% if asig.pk|stringformat:"i" == filtro_asignatura_actual %}selected{% endif %}>
                    {{ asig.nombre }}
                </option>
            {% endfor %}
        </select>

        <select name="tipo" class="p-2 border border-gray-300 rounded-md">
            <option value="">-- Todos los Tipos --</option>
            {% for tipo in tipos_material %}
                <option value="{{ tipo.pk }}" 
                    {% if tipo.pk|stringformat:"i" == filtro_tipo_actual %}selected{% endif %}>
                    {{ tipo.nombre }}
                </option>
            {% endfor %}
        </select>
        
        <button type="submit" class="btn-usm-primary px-4 py-2 rounded-md">
            Buscar
        </button>
        
        {% if query or filtro_asignatura_actual or filtro_tipo_actual %}
            <a href="{% url 'recursos:lista_recursos' %}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-150">
                Limpiar Filtros
            </a>
        {% endif %}
    </form>
    
    <div class="space-y-4">
        {% for material in materiales %}
        <div class="bg-white p-4 shadow rounded-lg flex justify-between items-start border-l-4 border-blue-400 hover:shadow-md transition duration-200">
            <div class="mr-4">
                <a href="{{ material.archivo.url }}" target="_blank" class="text-xl font-bold text-blue-600 hover:text-blue-800 hover:underline">
                    {{ material.titulo }}
                </a>
                <p class="text-sm text-gray-600 mt-1">{{ material.descripcion|truncatechars:150 }}</p>
                <div class="mt-2 text-xs space-x-3">
                    <span class="font-semibold text-gray-700 px-2 py-1 bg-gray-100 rounded">Asignatura: {{ material.asignatura.nombre }}</span>
                    <span class="font-semibold text-gray-700 px-2 py-1 bg-yellow-100 rounded">Tipo: {{ material.tipo_material.nombre }}</span>
                </div>
            </div>
            
            <div class="flex-shrink-0 text-right">
                <p class="text-xs text-gray-400">Subido por: {{ material.subido_por.username }}</p>

                {% if material.subido_por == user %}
                    <div class="mt-2 space-x-2">
                        <a href="{% url 'recursos:editar_recurso' pk=material.pk %}" class="text-sm text-yellow-600 hover:text-yellow-800 font-medium border border-yellow-600 px-2 py-1 rounded">
                            Editar
                        </a>
                        <a href="{% url 'recursos:eliminar_recurso' pk=material.pk %}" class="text-sm text-red-600 hover:text-red-800 font-medium border border-red-600 px-2 py-1 rounded">
                            Eliminar
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p class="text-center py-8 text-gray-500">No se encontraron materiales educativos que coincidan con la bÃºsqueda.</p>
        {% endfor %}
    </div>

</div>

{% endblock contenido %}